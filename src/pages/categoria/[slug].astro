---
import type { GetStaticPaths } from "astro";
import Layout from "@/layouts/Layout.astro"
import { getCollection } from "astro:content";
import SimpleCard from "@/components/SimpleCatCard.astro";

export  const  getStaticPaths  = (async() => {
  const categories = await getCollection('categories', ({data}) => data.active === true);
  return categories.map(({data}) => ({
    params: { slug: data.slug },
    props: { name: data.name, description: data.description},
  }));
}) satisfies GetStaticPaths;

const {slug} = Astro.params;
console.log(slug)
const {name, description} = Astro.props;
const products = await getCollection('products', ({data}) => data.categories.includes(slug));

export const prerender = true;
---

<Layout title={slug}>
  <SimpleCard name={name} description={description} active={true} slug={slug}/>
  {products.map(({data}) =>  
  <SimpleCard name={data.name} description={data.description} callToAction="Ver" slug={`${slug}/producto/${data.slug}`} active={false}/>)}
</Layout>