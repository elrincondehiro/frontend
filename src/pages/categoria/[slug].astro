---
import type { GetStaticPaths } from "astro";
import Layout from "@/layouts/Layout.astro"
import { getCollection } from "astro:content";
import SimpleCatCard from "@/components/SimpleCatCard.astro";
import SimpleProdCard from "@/components/SimpleProdCard.astro";

export  const  getStaticPaths  = (async() => {
  const categories = await getCollection('categories', ({data}) => data.active === true);
  return categories.map(({data}) => ({
    params: { slug: data.slug },
    props: { name: data.name, description: data.description},
  }));
}) satisfies GetStaticPaths;

const {slug} = Astro.params;
const {name, description} = Astro.props;
const products = await getCollection('products', ({data}) => data.categories.includes(slug));

export const prerender = true;
---

<Layout title={slug}>
  <SimpleCatCard name={name} description={description} active={true} slug={slug}/>
  {products.map(({data}) =>  
  <SimpleProdCard stock={data.stock} price={data.price} categories={data.categories} name={data.name} description={data.description} callToAction="Ver" slug={data.slug} active={data.active} archiveView={true}/>)}
</Layout>